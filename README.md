# ☁️ Java 服务热更新管理平台（Docker 版）

> 🧩 这是一个使用 Go 构建的轻量级服务管理平台，可在 **Docker 容器中实现 Java Jar 包的热更新与回滚**，并通过 Web 界面进行版本管理、服务切换、日志查看等操作。平台支持 **零停机部署**，适用于内部部署、测试或灰度环境。

---

# 测试nvim提交代码

## 📦 功能特性

- 🔥 **服务热部署**：上传新的 JAR 包后，自动分配端口并启动服务实例，只需要考虑向外暴露的端口而不是服务本身的端口。
- 🔁 **无中断服务切换**：运行中的服务可平滑切换到新版本，无需停止容器和服务，适用于服务不停机更新的场景。
- 🕰 **历史版本回滚**：支持一键回滚到任意历史版本。
- 📈 **日志流式查看**：支持 SSE 实时查看服务输出日志，支持实时日志输出和完整日志输出，便于查看日志
- 🖥 **Web 管理面板**：简洁的 UI 实现服务状态和版本操作。
- 📁 **版本归档与备份**：历史版本保存在本地，随时可切换或回滚。

---

## 🧱 项目结构

```shell
.
├── main.go                       # 应用入口，核心逻辑 
├── models/                       # 实体结构定义 
├── proxy/                        # 反向代理逻辑 
├── router/                       # 路由与接口注册 
├── service/                      # 服务实例管理（日志/启动/监控/版本） 
├── utils/                        # 辅助工具函数 
├── templates/                    # Gin 模板文件（HTML） 
    ├── static/                   # 静态资源（js/css） 
├── uploads/                      # 上传的 jar 包
├── logs/                         # 服务运行日志 
├── bak/                          # 历史版本 jar 包备份 
└── Dockerfile                    # 构建服务管理平台的 Dockerfile
```

------

## 🚀 快速开始

### 1️⃣ 克隆项目

```shell
git https://github.com/Xiao254182/bgproxy.git
cd bgproxy
```

### 2️⃣ 构建 Docker 镜像

```shell
docker build -f Dockerfile -t bgproxy:latest .
```

### 3️⃣ 运行容器

```shell
docker run -d \
  --name bgproxy \
  -p 3000:3000 \                        # 管理平台端口
  -p 8080-9000:8080-9000 \              # Java 服务运行端口范围(也可写固定端口)
  -v $(pwd)/uploads:/app/uploads \
  -v $(pwd)/bak:/app/bak \
  -v $(pwd)/logs:/app/logs \
  bgproxy:latest
```

### 🌐 访问管理平台

管理平台浏览器访问：http://localhost:3000

------

## 🧑‍💻 页面功能说明

| 页面     | 功能简介                             |
| -------- | ------------------------------------ |
| 首页     | 查看当前运行的主服务与待部署版本状态 |
| 上传     | 上传新 JAR 包并自动分配端口启动      |
| 切换服务 | 切换新版本为主服务（旧版本终止）     |
| 回滚版本 | 从历史版本中选一个回滚部署           |
| 实时日志 | 通过 SSE 查看服务运行日志            |

------

## 📦 JAR 包要求

- 支持 `--server.port` 参数设置端口（Spring Boot 等框架均支持）
- 例如：

```shell
java -jar your-app.jar --server.port=8080
```

------

## 🛠 API 接口说明（开发者调用）

| 方法 | 路径                   | 描述                                         |
| ---- | ---------------------- | -------------------------------------------- |
| GET  | `/`                    | 管理平台首页                                 |
| GET  | `/status`              | 获取当前服务状态                             |
| GET  | `/versions`            | 查询已备份版本                               |
| POST | `/upload`              | 上传新的 JAR 包                              |
| POST | `/switch`              | 切换至指定服务                               |
| POST | `/rollback`            | 回滚至历史版本                               |
| GET  | `/stream-log/:service` | 实时日志 SSE 推送（支持 `?full=1` 查看全部） |

------
## ⚠️ 使用建议
- 建议将日志、上传目录通过 Volume 映射以防容器销毁
- 端口范围 `8080-9000` 可在启动参数中自定义

------

## 🚧 已知限制

- 当前仅支持单容器运行，暂不支持分布式集群部署
------

## 🧰 技术栈

- **后端**：Go + Gin + HTML 模板引擎
- **前端**：原生 JS + HTML（支持静态文件引入）
- **部署**：Docker 支持快速构建与挂载

------
## 🤝 欢迎贡献

欢迎提交 PR 和 Star ⭐️
